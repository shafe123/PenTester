using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Xml.Serialization;

namespace PenTester.Objects.Nmap
{
    [Serializable]
    [XmlRoot("nmaprun")]
    public class NmapReport
    {
        [XmlElement("host", Form=System.Xml.Schema.XmlSchemaForm.Unqualified)]
        public List<Host> Hosts { get; set; }
    }

    public class Report
    {

    }

    public class Host
    {
        [XmlAttribute("starttime")]
        public long StartTime { get; set; }

        [XmlAttribute("endtime")]
        public long EndTime { get; set; }

        [XmlElement("address")]
        public List<Address> Addresses { get; set; }

        [XmlIgnore]
        public string IPAddress { get { return Addresses.Count(a => a.AddressType == "ipv4" || a.AddressLocation == "ipv6") == 0 ? "" : Addresses.Single(a => a.AddressType == "ipv4" || a.AddressLocation == "ipv6").AddressLocation; } }
        [XmlIgnore]
        public string MacAddress { get { return Addresses.Count(a => a.AddressType == "mac") == 0 ? "" : Addresses.Single(a => a.AddressType == "mac").AddressLocation; } }

        [XmlElement("ports")]
        public PortList PortsInformation { get; set; }
    }

    public class PortList
    {
        [XmlElement("port")]
        public List<Port> Ports { get; set; }
    }

    public class Port
    {
        [XmlAttribute("protocol")]
        public string Protocol { get; set; }

        [XmlAttribute("portid")]
        public int Number { get; set; }

        [XmlElement("service")]
        public Service Service { get; set; }
    }

    public class Service
    {
        [XmlAttribute("name")]
        public string ServiceName { get; set; }

        [XmlAttribute("product")]
        public string ServiceProduct { get; set; }

        [XmlAttribute("ostype")]
        public string OperatingSystem { get; set; }

        [XmlElement("cpe")]
        public string CPE { get; set; }
    }

    public class Address
    {
        [XmlAttribute("addr")]
        public string AddressLocation { get; set; }

        [XmlAttribute("addrtype")]
        public string AddressType { get; set; }

        [XmlAttribute("vendor")]
        public string Vendor { get; set; }
    }
}