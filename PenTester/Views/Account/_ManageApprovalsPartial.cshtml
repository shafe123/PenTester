@model IEnumerable<PenTester.Models.ApproveManageesModel>
@using PenTester.Models
@{
    ViewBag.Title = "Manage Users";
}

<h2>@ViewBag.Title</h2>

<h3>Approved</h3>
<ul id="ApprovedList">
    @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == true))
    {
        <li>
            @m.UserName
            @Html.CheckBox("cb" + m.UserId.ToString(), m.Approved, new { @onclick = "Disapprove(" + m.UserId + ")" })
        </li>
    }
</ul>
<h3>Pending</h3>
<ul id="PendingList">
    @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == null))
    {
        <li>
            @m.UserName
            @Html.CheckBox("cb" + m.UserId.ToString(), m.Approved, new { @onclick = "Approve(" + m.UserId + ")" })
        </li>
    }
</ul>
<h3>Denied</h3>
<ul id="DeniedList">
        @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == false))
    {
        <li>
            @m.UserName
            @Html.CheckBox("cb" + m.UserId.ToString(), m.Approved, new { @onclick = "Approve(" + m.UserId + ")" })
        </li>
    }
</ul>

<script type="text/javascript" >
    function Approve(id) {
        var checkValue = $("#cb" + id).first().val();
        var destUrl = "http://" + location.host + "/Account/ManageApprovals";
        var dat = { "UserId": id, "Approved": "true" };
        $.ajax({
            url: destUrl,
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(dat),
            async: true,
            success: MoveApprovedElement(id),
            error: UndoElement(id, checkValue)
        });
    }

    function MoveApprovedElement(id) {
        $("#cb" + id)[0].onclick = function () { Disapprove(id); };
        $("#cb" + id).parent().appendTo($("#ApprovedList"));
    }

    function UndoElement(id, checkValue) {
        $("#cb" + id).first().val(checkValue);
    }

    function Disapprove(id) {
        var checkValue = $("#cb" + id).first().val();
        var destUrl = "http://" + location.host + "/Account/ManageApprovals";
        var dat = { "UserId": id, "Approved": "false" };
        $.ajax({
            url: destUrl,
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(dat),
            async: true,
            success: RemoveDisapprovedElement(id),
            error: UndoElement(id, checkValue)
        });
    }

    function RemoveDisapprovedElement(id) {
        $("#cb" + id).parent().appendTo($("#DeniedList"));
        $("#cb" + id)[0].onclick = function () { Approve(id); };
    }
</script>