@model IEnumerable<PenTester.Models.ApproveManageesModel>
@using PenTester.Models
@{
    ViewBag.Title = "Manage Users";
}

<h2>@ViewBag.Title</h2>

<h3>Approved</h3>
<ul id="ApprovedList">
    @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == true))
    {
        <li id="@("app" + m.UserId)">
            @m.UserName
            <u onclick="Approve(@m.UserId)">Approve</u> 
            <u onclick="Disapprove(@m.UserId)">Disapprove</u>
        </li>
    }
</ul>
<h3>Pending</h3>
<ul id="PendingList">
    @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == null))
    {
        <li id="@("app" + m.UserId)">
            @m.UserName
            <u onclick="Approve(@m.UserId)">Approve</u> 
            <u onclick="Disapprove(@m.UserId)">Disapprove</u>
        </li>
    }
</ul>
<h3>Denied</h3>
<ul id="DeniedList">
    @foreach (ApproveManageesModel m in Model.Where(m => m.Approved == false))
    {
        <li id="@("app" + m.UserId)">
            @m.UserName
            <u onclick="Approve(@m.UserId)">Approve</u> 
            <u onclick="Disapprove(@m.UserId)">Disapprove</u>
        </li>
    }
</ul>

<script type="text/javascript" >

    function Approve(id) {
        var checkValue = $("#app" + id).first().val();
        var destUrl = "http://" + location.host + "/Account/ManageApprovals";
        var dat = { "UserId": id, "Approved": "true" };
        $.ajax({
            url: destUrl,
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(dat),
            async: true,
            success: MoveApprovedElement(id),
            error: UndoElement(id, checkValue)
        });
    }

    function MoveApprovedElement(id) {
        $("#app" + id).appendTo($("#ApprovedList"));
    }

    function Disapprove(id) {
        var checkValue = $("#app" + id).first().val();
        var destUrl = "http://" + location.host + "/Account/ManageApprovals";
        var dat = { "UserId": id, "Approved": "false" };
        $.ajax({
            url: destUrl,
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(dat),
            async: true,
            success: MoveDisapprovedElement(id),
            error: UndoElement(id, checkValue)
        });
    }

    function MoveDisapprovedElement(id) {
        $("#app" + id).appendTo($("#DeniedList"));
    }

    function UndoElement(id, checkValue) {
        //$("#app" + id).first().val(checkValue);
    }
</script>