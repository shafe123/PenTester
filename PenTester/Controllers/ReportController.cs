using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.Mvc;
using System.Web.DataAccess;
using System.Xml;

using PenTester.Models;
using WebMatrix.WebData;

// Remove RM.

namespace PenTester.Controllers
{
    public class ReportController : Controller
    {
        //
        // GET: /Report/

        [AllowAnonymous]
        public ActionResult ReportIndex()
        {
            //ViewBag.Message = "Upload a Report";
            //Create object populated with xml file
            XmlTextReader reader = new XmlTextReader("C:\\Users\\DSU\\Desktop\\nMapTestScan.xml");

            /*Ethan
             * Exact File paths?
             * 
             * For the 'Index' view I would use the database to pull a list of their reports
             * 
             * Entities db = new Entities();
                List<Report> repots = db.Reports.Where(r => r.OwnerId == WebSecurity.CurrentUserId);
             * 
             * Otherwise for reading in file paths do something like:
             * 
             * Entities db = new Entities();
                string directory = db.UserProfiles.Single(u => u.UserId == WebSecurity.CurrentUserId).DirectoryPath;
                XmlTextReader reader2 = new XmlTextReader(directory + "\\nMapTestScan.xml");
             */


            try
            {
                while (reader.Read())
                {
                    // Do some work here on the data.
                    //Inspecting Nodes
                    switch (reader.NodeType)
                    {
                        case XmlNodeType.Element: // The node is an element.
                            System.Diagnostics.Debug.WriteLine("<" + reader.Name);
                            System.Diagnostics.Debug.WriteLine(">");
                            break;
                        case XmlNodeType.Text: //Display the text in each element.
                            System.Diagnostics.Debug.WriteLine(reader.Value);
                            break;
                        case XmlNodeType.EndElement: //Display the end of the element.
                            System.Diagnostics.Debug.WriteLine("</" + reader.Name);
                            System.Diagnostics.Debug.WriteLine(">");
                            break;
                    }

                    /*
                    //Inspect Elements
                    switch (reader.NodeType)
                    {
                        case XmlNodeType.Element: // The node is an element.
                            Console.Write("<" + reader.Name);

                            while (reader.MoveToNextAttribute()) // Read the attributes.
                                Console.Write(" " + reader.Name + "='" + reader.Value + "'");
                            Console.WriteLine(">");
                            break;
                        case XmlNodeType.Text: //Display the text in each element.
                            Console.WriteLine(reader.Value);
                            break;
                        case XmlNodeType.EndElement: //Display the end of the element.
                            Console.Write("</" + reader.Name);
                            Console.WriteLine(">");
                            break;
                    }*/


                    Console.WriteLine(reader.Name);
                }
            }
            catch (InvalidCastException e)
            {
                throw (e);   // Rethrowing exception e
            }

            return View();
        }

    }
}
