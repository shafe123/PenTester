using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Xml;
using System.Xml.Serialization;
using PenTester.Objects.Nessus;
using PenTester.Objects.Nmap;
using PenTester.Objects;
using System.Diagnostics;
using Roslyn.Scripting;
using Roslyn.Scripting.CSharp;
using Roslyn.Compilers.CSharp;
using System.IO;
using System.Text;

namespace PenTester.Controllers
{
    public class HomeController : Controller
    {
        [AllowAnonymous]
        public ActionResult Test()
        {
            LoadCSIntoAssembly(@"C:\Users\Ethan\SkyDrive\Code13\PenTester\PenTester\Groups\2\Plugins\68dd3bc4-981a-4d61-994c-780aa8635c51.cs");
            return View();
        }

        private void LoadCSIntoAssembly(string csFile)
        {
            ScriptEngine engine = new ScriptEngine();
            Session s = engine.CreateSession();
            SyntaxTree tr = SyntaxTree.ParseFile(csFile);

            StringBuilder sb = new StringBuilder();
            foreach (ClassDeclarationSyntax classes in tr.GetRoot().Members.Where(m => m is ClassDeclarationSyntax))
            {
                sb.AppendLine(classes.Identifier.ToString());
                foreach (FieldDeclarationSyntax field in classes.Members.Where(cl => cl is FieldDeclarationSyntax))
                {
                    sb.AppendLine(field.ToString());
                }
            }
            string text = sb.ToString();

            System.IO.FileStream output = System.IO.File.Create(Path.GetDirectoryName(csFile) + "\\test.txt");
            byte[] bytes = System.Text.UTF8Encoding.UTF8.GetBytes(text);
            output.Write(bytes, 0, bytes.Length);

            output.Close();
        }

        [AllowAnonymous]
        public ActionResult Index(string id)
        {
            ViewBag.Message = "Modify this template to jump-start your ASP.NET MVC application.";

            if (id == "Awesome")
                ViewBag.Message = "I'm so Awesome!";

            return View();
        }

        public ActionResult About()
        {
            ViewBag.Message = "Your app description page.";

            return View();
        }

        [AllowAnonymous]
        public ActionResult Contact()
        {
            ViewBag.Message = "Your contact page.";

            return View();
        }
    }
}
