using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.Mvc;
using System.Web.DataAccess;

using PenTester.Models;
using WebMatrix.WebData;

namespace PenTester.Controllers
{
    public class PluginController : Controller
    {
        public ActionResult Upload()
        {
            Entities db = new Entities();
            ViewBag.IsManager = db.UserProfiles.Single(ent => ent.UserId == WebSecurity.CurrentUserId).IsManager.Value;

            return View("Index");
        }

        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult Upload(PluginModel plugin)
        {
            if (ModelState.IsValid)
            {
                //try
                //{
                    Entities db = new Entities();
                    Plugin toUpload = new Plugin() {
                        PluginName = plugin.PluginName,
                        PluginPath = plugin.PluginFile,
                        PluginGenerated = plugin.PluginFile
                    };

                    db.Plugins.Add(toUpload);
                    db.SaveChanges();
                //}
                
            }
            return RedirectToAction("Upload");
        }

    }
}
